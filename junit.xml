<?xml version="1.0" encoding="utf-8"?><testsuites name="pytest tests"><testsuite name="pytest" errors="1" failures="1" skipped="0" tests="3" time="107.681" timestamp="2026-01-02T12:52:30.718569+08:00" hostname="jxzhu"><testcase classname="tests.test_dipole_charge.TestDipoleChargeModifier" name="test_consistency" time="9.933"><failure message="AssertionError: &#10;Not equal to tolerance rtol=0.0001, atol=0&#10;&#10;Mismatched elements: 1 / 576 (0.174%)&#10;Max absolute difference: 0.01298256&#10;Max relative difference: 0.00010666&#10; x: array([ 5.478405e+03, -2.926191e+04, -4.316642e+03, -2.282402e+04,&#10;        3.770318e+03,  2.601577e+03, -6.445585e+03,  2.060087e+04,&#10;       -2.247642e+04,  6.872969e+02,  5.928845e+03, -6.894485e+03,...&#10; y: array([ 5.478406e+03, -2.926191e+04, -4.316643e+03, -2.282401e+04,&#10;        3.770321e+03,  2.601577e+03, -6.445586e+03,  2.060087e+04,&#10;       -2.247642e+04,  6.872969e+02,  5.928845e+03, -6.894482e+03,...">self = &lt;test_dipole_charge.TestDipoleChargeModifier testMethod=test_consistency&gt;

    def test_consistency(self):
        coord, box, atype = ref_data()
        # consistent with the input shape from BaseModifier.modify_data
        t_coord = to_torch_tensor(coord).to(DTYPE).reshape(1, -1, 3)
        t_box = to_torch_tensor(box).to(DTYPE).reshape(1, 3, 3)
        t_atype = to_torch_tensor(atype).to(torch.long)
    
        dm_pred = self.dm_pt(
            coord=t_coord,
            atype=t_atype,
            box=t_box,
        )
        e, f, v = self.dm_tf.eval(
            coord=coord,
            box=box,
            atype=atype,
        )
    
        np.testing.assert_allclose(
            to_numpy_array(dm_pred["energy"]).reshape(-1), e.reshape(-1), rtol=1e-4
        )
&gt;       np.testing.assert_allclose(
            to_numpy_array(dm_pred["force"]).reshape(-1), f.reshape(-1), rtol=1e-4
        )

tests/test_dipole_charge.py:110: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

args = (&lt;function assert_allclose.&lt;locals&gt;.compare at 0x7e53b8d1bd80&gt;, array([ 5.47840493e+03, -2.92619104e+04, -4.31664167e+...707e+03, -4.18359327e+03, -3.40074578e+03,
        1.14446357e+03, -2.11630141e+04,  9.93146758e+03, -8.37521806e+03]))
kwds = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=0.0001, atol=0', 'verbose': True}

    @wraps(func)
    def inner(*args, **kwds):
        with self._recreate_cm():
&gt;           return func(*args, **kwds)
                   ^^^^^^^^^^^^^^^^^^^
E           AssertionError: 
E           Not equal to tolerance rtol=0.0001, atol=0
E           
E           Mismatched elements: 1 / 576 (0.174%)
E           Max absolute difference: 0.01298256
E           Max relative difference: 0.00010666
E            x: array([ 5.478405e+03, -2.926191e+04, -4.316642e+03, -2.282402e+04,
E                   3.770318e+03,  2.601577e+03, -6.445585e+03,  2.060087e+04,
E                  -2.247642e+04,  6.872969e+02,  5.928845e+03, -6.894485e+03,...
E            y: array([ 5.478406e+03, -2.926191e+04, -4.316643e+03, -2.282401e+04,
E                   3.770321e+03,  2.601577e+03, -6.445586e+03,  2.060087e+04,
E                  -2.247642e+04,  6.872969e+02,  5.928845e+03, -6.894482e+03,...

/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/contextlib.py:81: AssertionError</failure></testcase><testcase classname="tests.test_dipole_charge.TestDipoleChargeModifier" name="test_jit" time="5.193" /><testcase time="0.000" /><testcase classname="pytest" name="internal" time="0.000"><error message="internal error">Traceback (most recent call last):
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/_pytest/main.py", line 318, in wrap_session
    session.exitstatus = doit(config, session) or 0
                         ^^^^^^^^^^^^^^^^^^^^^
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/_pytest/main.py", line 372, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/pluggy/_callers.py", line 167, in _multicall
    raise exception
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    teardown.throw(exception)
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/_pytest/logging.py", line 801, in pytest_runtestloop
    return (yield)  # Run all the tests.
            ^^^^^
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    teardown.throw(exception)
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/_pytest/terminal.py", line 707, in pytest_runtestloop
    result = yield
             ^^^^^
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    teardown.throw(exception)
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/pytest_cov/plugin.py", line 345, in pytest_runtestloop
    result = yield
             ^^^^^
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/_pytest/main.py", line 396, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/pluggy/_callers.py", line 167, in _multicall
    raise exception
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    teardown.throw(exception)
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/_pytest/warnings.py", line 89, in pytest_runtest_protocol
    return (yield)
            ^^^^^
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    teardown.throw(exception)
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/_pytest/assertion/__init__.py", line 192, in pytest_runtest_protocol
    return (yield)
            ^^^^^
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    teardown.throw(exception)
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/_pytest/unittest.py", line 587, in pytest_runtest_protocol
    return (yield)
            ^^^^^
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    teardown.throw(exception)
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/_pytest/faulthandler.py", line 102, in pytest_runtest_protocol
    return (yield)
            ^^^^^
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/_pytest/runner.py", line 118, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/_pytest/runner.py", line 137, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/_pytest/runner.py", line 249, in call_and_report
    report: TestReport = ihook.pytest_runtest_makereport(item=item, call=call)
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/pluggy/_callers.py", line 167, in _multicall
    raise exception
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    teardown.throw(exception)
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/_pytest/tmpdir.py", line 311, in pytest_runtest_makereport
    rep = yield
          ^^^^^
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    teardown.throw(exception)
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/_pytest/skipping.py", line 280, in pytest_runtest_makereport
    rep = yield
          ^^^^^
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/_pytest/runner.py", line 377, in pytest_runtest_makereport
    return TestReport.from_item_and_call(item, call)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/_pytest/reports.py", line 438, in from_item_and_call
    longrepr = _format_failed_longrepr(item, call, excinfo)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/_pytest/reports.py", line 263, in _format_failed_longrepr
    longrepr = item.repr_failure(excinfo)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/_pytest/python.py", line 1762, in repr_failure
    return self._repr_failure_py(excinfo, style=style)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/_pytest/nodes.py", line 456, in _repr_failure_py
    return excinfo.getrepr(
           ^^^^^^^^^^^^^^^^
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/_pytest/_code/code.py", line 765, in getrepr
    return fmt.repr_excinfo(self)
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/_pytest/_code/code.py", line 1200, in repr_excinfo
    reprtraceback = self.repr_traceback(excinfo_)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/_pytest/_code/code.py", line 1132, in repr_traceback
    entries = [
              ^
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/_pytest/_code/code.py", line 1133, in &lt;listcomp&gt;
    self.repr_traceback_entry(entry, excinfo if last == entry else None)
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/_pytest/_code/code.py", line 1063, in repr_traceback_entry
    source = self._getentrysource(entry)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/_pytest/_code/code.py", line 901, in _getentrysource
    source = entry.getsource(self.astcache)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/_pytest/_code/code.py", line 299, in getsource
    astnode, _, end = getstatementrange_ast(
                      ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/site-packages/_pytest/_code/source.py", line 191, in getstatementrange_ast
    astnode = ast.parse(content, "source", "exec")
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jxzhu/apps/miniconda3/envs/deepmd-pt-dplr/lib/python3.11/ast.py", line 50, in parse
    return compile(source, filename, mode, flags,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
SystemError: AST constructor recursion depth mismatch (before=123, after=142)</error></testcase></testsuite></testsuites>